<app-base-page-layout pageTitle="Preventive Maintenance Analysis">
  <!-- Topic 1: Distribution Transformer (DT) Loading Report -->
  <app-topic-section title="Distribution Transformer (DT) Loading Report" [topicNumber]="1" (opened)="onTopicSectionOpened($event)">
    <div class="space-y-4">
      <h3 class="text-md font-semibold" [style.color]="'var(--text-primary)'">1.1 DT Loading Summary</h3>
      <app-data-table [data]="getDTLoadingSummaryWithIds()" [columns]="dtLoadingSummaryColumns"></app-data-table>
    </div>
    <div class="space-y-4">
      <h3 class="text-md font-semibold" [style.color]="'var(--text-primary)'">1.2 DT-Wise Loading Details</h3>
      <div class="bg-card border rounded-xl p-4 mb-4" [style.border-color]="'var(--border-color)'" [style.background-color]="'var(--bg-card)'">
        <p class="text-sm" [style.color]="'var(--text-secondary)'">
          <strong [style.color]="'var(--text-primary)'">Loading %</strong> = (Max Load in kW / DT Capacity in kVA) × 100<br>
          Assume PF ≈ 1 for simplicity or adjust with actual PF if available.
        </p>
      </div>
      <app-data-table [data]="dtLoadingDetails" [columns]="dtLoadingDetailColumns"></app-data-table>
    </div>
    <app-insights-card [insights]="[
      '[X] DTs are Overloaded, mainly in [Area/Feeder Name].',
      'Under-loaded DTs found in [Area Name] indicate possible over-sizing.',
      'Potential redistribution or augmentation required in overloaded areas.'
    ]"></app-insights-card>
  </app-topic-section>

  <!-- Topic 2: Load Management & Preventive Maintenance Analysis Report -->
  <app-topic-section title="Load Management & Preventive Maintenance Analysis Report: Top Overloaded DTs and Load Rising Trends – Preventive Action Planning" [topicNumber]="2" (opened)="onTopicSectionOpened($event)">
    <app-summary-tiles [data]="preventiveMaintenanceSummary"></app-summary-tiles>
    <div class="space-y-4">
      <h3 class="text-md font-semibold" [style.color]="'var(--text-primary)'">2.1 Top Overloaded DTs – Preventive Maintenance Priority List</h3>
      <div class="bg-card border rounded-xl p-4 mb-4" [style.border-color]="'var(--border-color)'" [style.background-color]="'var(--bg-card)'">
        <h4 class="text-sm font-semibold mb-2" [style.color]="'var(--text-primary)'">Risk Level Logic:</h4>
        <ul class="space-y-1 text-sm" [style.color]="'var(--text-secondary)'">
          <li><strong>High</strong> = Load >120% for more than 15 days OR load rising >4% MoM.</li>
          <li><strong>Medium</strong> = Load 110–120% OR rising trend >2% MoM.</li>
          <li><strong>Low</strong> = Load 100–110% OR minor rising trend.</li>
        </ul>
      </div>
      <app-data-table [data]="overloadedDTs" [columns]="overloadedDTColumns"></app-data-table>
    </div>
    <div class="space-y-4">
      <h3 class="text-md font-semibold" [style.color]="'var(--text-primary)'">2.2 Load Rising Trend – Historical Analysis (Last 6 Months)</h3>
      <app-data-table [data]="loadRisingTrends" [columns]="loadRisingTrendColumns"></app-data-table>
      <app-chart-placeholder [title]="'Load Rising Trend (Last 6 Months)'" [type]="'line'" [data]="loadRisingTrends"></app-chart-placeholder>
    </div>
    <div class="space-y-4">
      <h3 class="text-md font-semibold" [style.color]="'var(--text-primary)'">2.3 Preventive Maintenance Recommendations</h3>
      <div class="grid gap-4 md:grid-cols-3">
        <div class="bg-card border rounded-xl p-4" [style.border-color]="'var(--border-color)'" [style.background-color]="'var(--bg-card)'">
          <h4 class="text-sm font-semibold mb-3" [style.color]="'var(--text-primary)'">Immediate Actions (within 1 month):</h4>
          <ul class="space-y-1 text-sm" [style.color]="'var(--text-secondary)'">
            <li>• Oil & Insulation Tests for DTs >120% load consistently.</li>
            <li>• Thermal Scanning for hot spot identification.</li>
            <li>• Load Redistribution to nearby underloaded DTs.</li>
            <li>• Install Load Monitoring Sensors for real-time alerts.</li>
          </ul>
        </div>
        <div class="bg-card border rounded-xl p-4" [style.border-color]="'var(--border-color)'" [style.background-color]="'var(--bg-card)'">
          <h4 class="text-sm font-semibold mb-3" [style.color]="'var(--text-primary)'">Medium-Term Actions (1–3 months):</h4>
          <ul class="space-y-1 text-sm" [style.color]="'var(--text-secondary)'">
            <li>• Upgrade DT capacity where growth trend >4% MoM.</li>
            <li>• Review Feeder Loading to prevent upstream overload.</li>
            <li>• Customer Awareness Campaign in high theft/overload areas.</li>
          </ul>
        </div>
        <div class="bg-card border rounded-xl p-4" [style.border-color]="'var(--border-color)'" [style.background-color]="'var(--bg-card)'">
          <h4 class="text-sm font-semibold mb-3" [style.color]="'var(--text-primary)'">Long-Term Actions (3–12 months):</h4>
          <ul class="space-y-1 text-sm" [style.color]="'var(--text-secondary)'">
            <li>• Strategic Network Planning to add new DTs in high-growth zones.</li>
            <li>• Deploy Predictive Analytics to flag high-risk DTs earlier.</li>
          </ul>
        </div>
      </div>
    </div>
  </app-topic-section>
</app-base-page-layout>
