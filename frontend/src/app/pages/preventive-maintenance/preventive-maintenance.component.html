<div class="main-container w-full relative" [style.background-color]="'var(--bg-primary)'">
  <div class="flex w-full h-full flex-col items-start flex-nowrap relative">
    <div class="flex justify-start items-start self-stretch flex-1 min-h-0 flex-nowrap relative z-[1]">
      <div class="flex items-start w-full h-full flex-nowrap relative z-[2]">
        <!-- Sidebar Component -->
        <app-sidebar></app-sidebar>

        <!-- Main Content Area -->
        <div class="flex flex-col items-start flex-1 min-h-0 flex-nowrap relative z-[4]" [style.background-color]="'var(--bg-secondary)'">
          <!-- Main Header -->
          <div class="flex h-14 pt-0 pr-4 pb-0 pl-4 gap-4 items-center self-stretch shrink-0 flex-nowrap bg-[rgba(8,12,22,0.6)] relative z-[5]">
            <div class="flex items-start shrink-0 flex-nowrap relative">
              <div class="flex gap-2.5 items-center self-stretch shrink-0 flex-wrap relative">
                <div class="flex flex-col items-start flex-nowrap relative">
                  <span class="h-5 shrink-0 basis-auto font-inter text-sm font-normal leading-5 relative text-left whitespace-nowrap" [style.color]="'var(--text-secondary)'">Home</span>
                </div>
                <div class="flex w-3.5 flex-col items-start flex-nowrap relative">
                  <div class="w-3.5 h-3.5 shrink-0 bg-[url(https://codia-f2c.s3.us-west-1.amazonaws.com/default/image/2025-12-25/b944d036-985d-4995-9e5b-353de5c1111a.png)] bg-cover bg-no-repeat relative"></div>
                </div>
                <div class="flex flex-col items-start flex-nowrap relative">
                  <span class="h-5 shrink-0 basis-auto font-inter text-sm font-normal leading-5 relative text-left whitespace-nowrap" [style.color]="'var(--text-primary)'">Preventive Maintenance Analysis</span>
                </div>
              </div>
            </div>
            <div class="flex pt-0 pr-0 pb-0 pl-auto flex-col items-end grow shrink-0 basis-0 flex-nowrap relative">
              <div class="flex gap-2 items-center shrink-0 flex-nowrap relative">
                <a class="header-icon flex w-8 h-8 justify-center items-center shrink-0 flex-nowrap rounded-[10px] relative cursor-pointer hover:opacity-75 transition-opacity">
                  <div class="w-4 h-4 shrink-0 bg-[url(https://codia-f2c.s3.us-west-1.amazonaws.com/default/image/2025-12-25/9db7dd38-a12d-476a-8fed-674d65495f8b.png)] bg-cover bg-no-repeat relative"></div>
                </a>
                <a class="header-icon flex w-8 h-8 justify-center items-center shrink-0 flex-nowrap rounded-[10px] relative cursor-pointer hover:opacity-75 transition-opacity">
                  <div class="w-4 h-4 shrink-0 bg-[url(https://codia-f2c.s3.us-west-1.amazonaws.com/default/image/2025-12-25/e15e0882-e566-4fe2-8222-392b0128c1e9.png)] bg-cover bg-no-repeat relative"></div>
                  <div class="w-2 h-2 shrink-0 bg-[#ef4343] rounded-full absolute top-1 right-1"></div>
                </a>
                <div class="w-px h-6 shrink-0 relative" [style.background-color]="'var(--border-color)'"></div>
                <a class="header-icon flex w-8 h-8 justify-center items-center shrink-0 flex-nowrap rounded-[10px] relative cursor-pointer hover:opacity-75 transition-opacity">
                  <div class="w-4 h-4 shrink-0 bg-[url(https://codia-f2c.s3.us-west-1.amazonaws.com/default/image/2025-12-25/8a1a247e-5e69-47f3-abc2-2d7e211352a2.png)] bg-cover bg-no-repeat relative"></div>
                </a>
              </div>
            </div>
          </div>

          <!-- Main Content Sections -->
          <div class="flex flex-col items-start self-stretch flex-1 min-h-0 flex-nowrap relative overflow-y-auto overflow-x-visible z-[28]" style="max-height: calc(100vh - 56px);">
            <div class="container mx-auto px-6 py-8 w-full pb-8">
              <!-- Topic 1: Distribution Transformer (DT) Loading Report -->
              <app-topic-section title="Distribution Transformer (DT) Loading Report" [topicNumber]="1" [defaultOpen]="true" [isOpen]="true" (opened)="onTopicSectionOpened($event)">
                <div class="space-y-4">
                  <h3 class="text-md font-semibold" [style.color]="'var(--text-primary)'">1.1 DT Loading Summary</h3>
                  <app-data-table [data]="getDTLoadingSummaryWithIds()" [columns]="dtLoadingSummaryColumns"></app-data-table>
                </div>
                <div class="space-y-4">
                  <h3 class="text-md font-semibold" [style.color]="'var(--text-primary)'">1.2 DT-Wise Loading Details</h3>
                  <div class="bg-card border rounded-xl p-4 mb-4" [style.border-color]="'var(--border-color)'" [style.background-color]="'var(--bg-card)'">
                    <p class="text-sm" [style.color]="'var(--text-secondary)'">
                      <strong [style.color]="'var(--text-primary)'">Loading %</strong> = (Max Load in kW / DT Capacity in kVA) × 100<br>
                      Assume PF ≈ 1 for simplicity or adjust with actual PF if available.
                    </p>
                  </div>
                  <app-data-table [data]="dtLoadingDetails" [columns]="dtLoadingDetailColumns"></app-data-table>
                </div>
                <app-insights-card [insights]="[
                  '[X] DTs are Overloaded, mainly in [Area/Feeder Name].',
                  'Under-loaded DTs found in [Area Name] indicate possible over-sizing.',
                  'Potential redistribution or augmentation required in overloaded areas.'
                ]"></app-insights-card>
              </app-topic-section>

              <!-- Topic 2: Load Management & Preventive Maintenance Analysis Report -->
              <app-topic-section title="Load Management & Preventive Maintenance Analysis Report: Top Overloaded DTs and Load Rising Trends – Preventive Action Planning" [topicNumber]="2" (opened)="onTopicSectionOpened($event)">
                <app-summary-tiles [data]="preventiveMaintenanceSummary"></app-summary-tiles>
                <div class="space-y-4">
                  <h3 class="text-md font-semibold" [style.color]="'var(--text-primary)'">2.1 Top Overloaded DTs – Preventive Maintenance Priority List</h3>
                  <div class="bg-card border rounded-xl p-4 mb-4" [style.border-color]="'var(--border-color)'" [style.background-color]="'var(--bg-card)'">
                    <h4 class="text-sm font-semibold mb-2" [style.color]="'var(--text-primary)'">Risk Level Logic:</h4>
                    <ul class="space-y-1 text-sm" [style.color]="'var(--text-secondary)'">
                      <li><strong>High</strong> = Load >120% for more than 15 days OR load rising >4% MoM.</li>
                      <li><strong>Medium</strong> = Load 110–120% OR rising trend >2% MoM.</li>
                      <li><strong>Low</strong> = Load 100–110% OR minor rising trend.</li>
                    </ul>
                  </div>
                  <app-data-table [data]="overloadedDTs" [columns]="overloadedDTColumns"></app-data-table>
                </div>
                <div class="space-y-4">
                  <h3 class="text-md font-semibold" [style.color]="'var(--text-primary)'">2.2 Load Rising Trend – Historical Analysis (Last 6 Months)</h3>
                  <app-data-table [data]="loadRisingTrends" [columns]="loadRisingTrendColumns"></app-data-table>
                  <app-chart-placeholder [title]="'Load Rising Trend (Last 6 Months)'" [type]="'line'" [data]="loadRisingTrends"></app-chart-placeholder>
                </div>
                <div class="space-y-4">
                  <h3 class="text-md font-semibold" [style.color]="'var(--text-primary)'">2.3 Preventive Maintenance Recommendations</h3>
                  <div class="grid gap-4 md:grid-cols-3">
                    <div class="bg-card border rounded-xl p-4" [style.border-color]="'var(--border-color)'" [style.background-color]="'var(--bg-card)'">
                      <h4 class="text-sm font-semibold mb-3" [style.color]="'var(--text-primary)'">Immediate Actions (within 1 month):</h4>
                      <ul class="space-y-1 text-sm" [style.color]="'var(--text-secondary)'">
                        <li>• Oil & Insulation Tests for DTs >120% load consistently.</li>
                        <li>• Thermal Scanning for hot spot identification.</li>
                        <li>• Load Redistribution to nearby underloaded DTs.</li>
                        <li>• Install Load Monitoring Sensors for real-time alerts.</li>
                      </ul>
                    </div>
                    <div class="bg-card border rounded-xl p-4" [style.border-color]="'var(--border-color)'" [style.background-color]="'var(--bg-card)'">
                      <h4 class="text-sm font-semibold mb-3" [style.color]="'var(--text-primary)'">Medium-Term Actions (1–3 months):</h4>
                      <ul class="space-y-1 text-sm" [style.color]="'var(--text-secondary)'">
                        <li>• Upgrade DT capacity where growth trend >4% MoM.</li>
                        <li>• Review Feeder Loading to prevent upstream overload.</li>
                        <li>• Customer Awareness Campaign in high theft/overload areas.</li>
                      </ul>
                    </div>
                    <div class="bg-card border rounded-xl p-4" [style.border-color]="'var(--border-color)'" [style.background-color]="'var(--bg-card)'">
                      <h4 class="text-sm font-semibold mb-3" [style.color]="'var(--text-primary)'">Long-Term Actions (3–12 months):</h4>
                      <ul class="space-y-1 text-sm" [style.color]="'var(--text-secondary)'">
                        <li>• Strategic Network Planning to add new DTs in high-growth zones.</li>
                        <li>• Deploy Predictive Analytics to flag high-risk DTs earlier.</li>
                      </ul>
                    </div>
                  </div>
                </div>
              </app-topic-section>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
