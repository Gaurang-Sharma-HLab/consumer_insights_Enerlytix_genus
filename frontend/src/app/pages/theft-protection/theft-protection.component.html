<app-base-page-layout pageTitle="Theft Protection Analysis">
  <!-- Topic 1: Consumers with Consumption Lower Than Expected Pattern -->
  <app-topic-section title="Consumers with Consumption Lower Than Expected Pattern" [topicNumber]="1" (opened)="onTopicSectionOpened($event)">
    <app-summary-tiles [data]="lowerThanExpectedSummary"></app-summary-tiles>
    <div class="space-y-4">
      <h3 class="text-md font-semibold" [style.color]="'var(--text-primary)'">1.1 Consumer-wise Report</h3>
      <app-data-table [data]="lowerThanExpectedConsumers" [columns]="lowerThanExpectedColumns"></app-data-table>
    </div>
    <app-insights-card [insights]="[
      'AMISP to Validate: Check for potential metering issues or communication gaps.',
      'Field Team to Investigate: Physical site inspection where deviation >25%.',
      'Consumer Notification: Alert to be issued in case of recurring anomalies.',
      'Rectification: Rectify wiring, communication, or technical issues if detected.'
    ]"></app-insights-card>
  </app-topic-section>

  <!-- Topic 2: Day Use with Zero Night Consumption -->
  <app-topic-section title="Abnormal Consumption Pattern – Day Use with Zero Night Consumption" [topicNumber]="2" (opened)="onTopicSectionOpened($event)">
    <app-summary-tiles [data]="dayNightSummary"></app-summary-tiles>
    <div class="space-y-4">
      <h3 class="text-md font-semibold" [style.color]="'var(--text-primary)'">2.1 Consumer-wise Report (Day Consumption with Zero Night Units)</h3>
      <app-data-table [data]="dayNightConsumers" [columns]="dayNightConsumerColumns"></app-data-table>
    </div>
    <app-insights-card [insights]="[
      '342 consumers show consistent zero-night consumption despite normal day usage.',
      'Mostly observed in urban slums / high-density residential areas.',
      'Possible bypassing or night-time disconnect of metering circuit.'
    ]"></app-insights-card>
  </app-topic-section>

  <!-- Topic 3: Net Meters with Export During Odd Hours -->
  <app-topic-section title="Net Meters with Export During Odd Hours" [topicNumber]="3" (opened)="onTopicSectionOpened($event)">
    <app-summary-tiles [data]="netMeterExportSummary"></app-summary-tiles>
    <div class="space-y-4">
      <h3 class="text-md font-semibold" [style.color]="'var(--text-primary)'">3.1 Consumer-wise Report</h3>
      <app-data-table [data]="netMeterExports" [columns]="netMeterExportColumns"></app-data-table>
    </div>
    <app-insights-card [insights]="[
      'Site Inspection: Verify wiring correctness and inverter configuration at site.',
      'Data Validation: Cross-verify with meter load survey and inverter logs.',
      'Consumer Communication: Notify consumer for explanation, if needed.',
      'Rectification: Correct polarity or disconnection of unauthorized sources, if identified.'
    ]"></app-insights-card>
  </app-topic-section>

  <!-- Topic 4: Suspected Consumers Report – Tamper Analytics & Profiling -->
  <app-topic-section title="Suspected Consumers Report – Tamper Analytics & Profiling" [topicNumber]="4" (opened)="onTopicSectionOpened($event)">
    <app-summary-tiles [data]="tamperAnalyticsSummary"></app-summary-tiles>
    <div class="space-y-4">
      <h3 class="text-md font-semibold" [style.color]="'var(--text-primary)'">4.1 Tamper-Based Risk Classification Logic</h3>
      <div class="bg-card border rounded-xl p-4" [style.border-color]="'var(--border-color)'" [style.background-color]="'var(--bg-card)'">
        <ul class="space-y-2" [style.color]="'var(--text-secondary)'">
          <li><strong [style.color]="'var(--text-primary)'">High Risk</strong> = Tamper Score ≥ 12 in a month</li>
          <li><strong [style.color]="'var(--text-primary)'">Medium Risk</strong> = Tamper Score 7–11</li>
          <li><strong [style.color]="'var(--text-primary)'">Low Risk</strong> = Tamper Score < 7</li>
        </ul>
      </div>
    </div>
    <div class="space-y-4">
      <h3 class="text-md font-semibold" [style.color]="'var(--text-primary)'">4.2 Tamper Event Weightage</h3>
      <app-data-table [data]="getTamperEventsWithIds()" [columns]="tamperEventColumns"></app-data-table>
    </div>
    <div class="space-y-4">
      <h3 class="text-md font-semibold" [style.color]="'var(--text-primary)'">4.3 Consumer-Wise Suspected Tamper Event Summary</h3>
      <app-data-table [data]="suspectedTamperConsumers" [columns]="suspectedTamperConsumerColumns"></app-data-table>
    </div>
    <div class="space-y-4">
      <h3 class="text-md font-semibold" [style.color]="'var(--text-primary)'">4.4 Area-Wise / Feeder-Wise Heatmap of High-Risk Consumers</h3>
      <app-data-table [data]="areaWiseTamperHeatmap" [columns]="areaWiseTamperHeatmapColumns"></app-data-table>
    </div>
    <app-insights-card [insights]="[
      'Immediate field inspection of all High-Risk consumers within 7 days.',
      'Equip field teams with previous theft cases and tamper analytics during site visit.',
      'Loop closure to be done by AMISP within 48 hours of field action (report with photo evidence).',
      'Tag consumers in MDMS for continuous tamper alert tracking.',
      'Recommend CT calibration or meter replacement for flagged CT Open/BYPASS repeat events.'
    ]"></app-insights-card>
  </app-topic-section>
</app-base-page-layout>
