<app-base-page-layout pageTitle="Consumer Data Analysis">
  <!-- Topic 1: Abnormal Consumption Pattern -->
  <app-topic-section title="Abnormal Consumption Pattern" [topicNumber]="1" (opened)="onTopicSectionOpened($event)">
    <app-summary-tiles [data]="abnormalConsumptionSummary"></app-summary-tiles>
    <div class="space-y-4">
      <h3 class="text-md font-semibold" [style.color]="'var(--text-primary)'">1.1 High Consumption Cases</h3>
      <app-data-table [data]="highConsumptionCases" [columns]="highConsumptionColumns"></app-data-table>
    </div>
    <div class="space-y-4">
      <h3 class="text-md font-semibold" [style.color]="'var(--text-primary)'">1.2 Low Consumption / Zero Units Cases</h3>
      <app-data-table [data]="lowConsumptionCases" [columns]="lowConsumptionColumns"></app-data-table>
    </div>
    <div class="grid gap-6 lg:grid-cols-2">
      <app-chart-placeholder [title]="'Top 10 Consumers – Sudden Spike'" [type]="'bar'" [data]="spikeChartData"></app-chart-placeholder>
      <app-chart-placeholder [title]="'Top 10 Consumers – Sudden Drop'" [type]="'bar'" [data]="dropChartData"></app-chart-placeholder>
    </div>
  </app-topic-section>

  <!-- Topic 2: Zero Consumption Analysis -->
  <app-topic-section title="Zero Consumption Analysis Report" [topicNumber]="2" (opened)="onTopicSectionOpened($event)">
    <app-summary-tiles [data]="zeroConsumptionMetrics"></app-summary-tiles>
    <div class="space-y-4">
      <h3 class="text-md font-semibold" [style.color]="'var(--text-primary)'">2.1 Categorized Breakdown</h3>
      <app-data-table [data]="getZeroConsumptionCategoriesWithIds()" [columns]="zeroConsumptionCategoryColumns"></app-data-table>
    </div>
    <div class="space-y-4">
      <h3 class="text-md font-semibold" [style.color]="'var(--text-primary)'">2.2 Sample Consumer-wise Data</h3>
      <app-data-table [data]="zeroConsumptionConsumers" [columns]="zeroConsumptionConsumerColumns"></app-data-table>
    </div>
    <div class="grid gap-6 lg:grid-cols-3">
      <app-chart-placeholder [title]="'Root Cause Distribution'" [type]="'pie'" [data]="zeroConsumptionCategories"></app-chart-placeholder>
      <app-chart-placeholder [title]="'Zero Consumption by Circle'" [type]="'bar'" [data]="circleZeroConsumptionData"></app-chart-placeholder>
      <app-chart-placeholder [title]="'Zero Consumption Trend (Monthly)'" [type]="'line'" [data]="zeroConsumptionTrendData"></app-chart-placeholder>
    </div>
    <app-insights-card [insights]="[
      '25% of zero consumption cases are from non-communicating meters.',
      'Repeated cases from North subdivision indicating possible field process issue.',
      '12% cases have meter energy data but not billed – MDMS to UBS sync issue suspected.'
    ]"></app-insights-card>
  </app-topic-section>

  <!-- Topic 3: Consumption Drop Analysis -->
  <app-topic-section title="Consumption Drop Analysis Report – Post Smart Meter Installation" [topicNumber]="3" (opened)="onTopicSectionOpened($event)">
    <app-data-table [data]="getConsumptionDropSummaryWithIds()" [columns]="consumptionDropSummaryColumns"></app-data-table>
    <div class="space-y-4">
      <h3 class="text-md font-semibold" [style.color]="'var(--text-primary)'">3.1 Consumer-Wise Consumption Comparison</h3>
      <app-data-table [data]="consumptionDropConsumers" [columns]="consumptionDropConsumerColumns"></app-data-table>
    </div>
  </app-topic-section>

  <!-- Topic 4: Low Consumption Trend -->
  <app-topic-section title="Low Consumption Trend Report" [topicNumber]="4" (opened)="onTopicSectionOpened($event)">
    <app-data-table [data]="getLowConsumptionSummaryWithIds()" [columns]="lowConsumptionSummaryColumns"></app-data-table>
    <div class="space-y-4">
      <h3 class="text-md font-semibold" [style.color]="'var(--text-primary)'">4.1 Consumer-Wise Analysis</h3>
      <app-data-table [data]="lowConsumptionConsumers" [columns]="lowConsumptionConsumerColumns"></app-data-table>
    </div>
    <app-insights-card [insights]="[
      'Majority of the drops observed in LT Commercial / HT Industrial category.',
      'Possible causes: Consumer energy optimization, Meter under-recording, Load shifting or seasonal impact.',
      'Total of 567 consumers show more than 30% drop YoY.'
    ]"></app-insights-card>
  </app-topic-section>

  <!-- Topic 5: Consumption Lower Than Expected -->
  <app-topic-section title="Consumers with Consumption Lower Than Expected Pattern" [topicNumber]="5" (opened)="onTopicSectionOpened($event)">
    <app-data-table [data]="lowerThanExpectedConsumers" [columns]="lowerThanExpectedColumns"></app-data-table>
    <app-insights-card [insights]="[
      'AMISP to Validate: Check for potential metering issues or communication gaps.',
      'Field Team to Investigate: Physical site inspection where deviation >25%.',
      'Consumer Notification: Alert to be issued in case of recurring anomalies.'
    ]"></app-insights-card>
  </app-topic-section>

  <!-- Topic 6: Consumer Profiling & Bucketing -->
  <app-topic-section title="Consumer Consumption Profiling & Bucketing Report" [topicNumber]="6" (opened)="onTopicSectionOpened($event)">
    <div class="space-y-4">
      <h3 class="text-md font-semibold" [style.color]="'var(--text-primary)'">6.1 Bucketing Logic</h3>
      <app-bucket-logic-table [data]="bucketLogic"></app-bucket-logic-table>
    </div>
    <div class="space-y-4">
      <h3 class="text-md font-semibold" [style.color]="'var(--text-primary)'">6.2 Consumer-Wise Profiling</h3>
      <app-data-table [data]="consumerProfiles" [columns]="consumerProfileColumns"></app-data-table>
    </div>
    <div class="space-y-4">
      <h3 class="text-md font-semibold" [style.color]="'var(--text-primary)'">6.3 Summary by Category & Bucket</h3>
      <app-bucket-summary-table [data]="bucketSummary"></app-bucket-summary-table>
    </div>
    <app-insights-card [insights]="[
      'Prioritize High Risk consumers for inspection and automated alerts.',
      'Issue load enhancement notices where MD consistently exceeds SL.',
      'Investigate zero use consumers with sanctioned load >1 kW.',
      'Update risk categorization monthly or as per data availability.'
    ]"></app-insights-card>
  </app-topic-section>

  <!-- Topic 7: Communication Gap & Ageing Analytics -->
  <app-topic-section title="Communication Gap & Ageing Analytics Report" [topicNumber]="7" (opened)="onTopicSectionOpened($event)">
    <app-summary-tiles [data]="communicationGapSummary"></app-summary-tiles>
    <div class="space-y-4">
      <h3 class="text-md font-semibold" [style.color]="'var(--text-primary)'">7.1 Communication Failure Ageing Category Summary</h3>
      <app-data-table [data]="getCommunicationAgeingCategoriesWithIds()" [columns]="communicationAgeingCategoryColumns"></app-data-table>
    </div>
    <div class="space-y-4">
      <h3 class="text-md font-semibold" [style.color]="'var(--text-primary)'">7.2 Circle / Division Level Breakdown</h3>
      <app-data-table [data]="communicationCircleBreakdown" [columns]="communicationCircleBreakdownColumns"></app-data-table>
    </div>
    <div class="space-y-4">
      <h3 class="text-md font-semibold" [style.color]="'var(--text-primary)'">7.3 Sample Meter-Level Detail (Extract)</h3>
      <app-data-table [data]="communicationMeterDetails" [columns]="communicationMeterDetailColumns"></app-data-table>
    </div>
    <div class="space-y-4">
      <h3 class="text-md font-semibold" [style.color]="'var(--text-primary)'">7.4 Root Cause Classification</h3>
      <app-data-table [data]="getCommunicationRootCausesWithIds()" [columns]="communicationRootCauseColumns"></app-data-table>
    </div>
    <div class="space-y-4">
      <h3 class="text-md font-semibold" [style.color]="'var(--text-primary)'">7.5 Action Tracker – For AMISP</h3>
      <app-data-table [data]="communicationActionTracker" [columns]="communicationActionTrackerColumns"></app-data-table>
    </div>
    <app-insights-card [insights]="[
      '38% of communication failures are due to RF coverage issues - infrastructure upgrade needed.',
      'Meters with >30 days ageing require immediate field intervention.',
      '234 meters never communicated since installation - MDM configuration review required.',
      'Prioritize action tracker items with deadlines approaching within 7 days.'
    ]"></app-insights-card>
  </app-topic-section>
</app-base-page-layout>
